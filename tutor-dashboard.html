<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Nexon Tutoring â€” Session Logger</title>

<style>
/* ---------------------------
   ğ—Ÿğ˜‚ğ˜…ğ˜‚ğ—¿ğ˜† ğ—•ğ—®ğ—°ğ—¸ğ—´ğ—¿ğ—¼ğ˜‚ğ—»ğ—±
---------------------------- */
body {
  margin: 0;
  font-family: "Inter", Segoe UI, Arial, sans-serif;
  background: url("bg.jpg") no-repeat center center/cover;
  position: relative;
  min-height: 100vh;
  color: #d4af37;
}

body::before {
  content: "";
  position: absolute;
  top:0; left:0; width:100%; height:100%;
  background: rgba(0,0,0,0.65);
  backdrop-filter: blur(4px);
  z-index: 0;
}

/* ---------------------------
   ğ—Ÿğ—®ğ˜†ğ—¼ğ˜‚ğ˜ & ğ—£ğ—®ğ—»ğ—²ğ—¹ğ˜€
---------------------------- */
.app {
  position: relative;
  z-index: 1;
  max-width: 1200px;
  margin: 20px auto;
  display: grid;
  grid-template-rows: auto 1fr auto;
  gap: 16px;
  padding: 0 16px 40px;
}

.top {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.brand .logo {
  font-weight: 800;
  font-size: 24px;
  letter-spacing: 1px;
}
.brand .subtitle {
  font-size: 14px;
  color: rgba(212,175,55,0.85);
}

.btn {
  padding: 10px 18px;
  border-radius: 12px;
  border: 1px solid #d4af37;
  background: rgba(15,15,15,0.52);
  backdrop-filter: blur(8px);
  color: #d4af37;
  cursor: pointer;
  font-weight: 600;
  letter-spacing: 0.3px;
  transition: all 0.3s ease;
}
.btn:hover {
  background: rgba(212,175,55,0.15);
  box-shadow: 0 0 12px rgba(212,175,55,0.5);
}

.layout {
  display: grid;
  grid-template-columns: 300px 1fr;
  gap: 16px;
}

.panel {
  background: rgba(15,15,15,0.52);
  backdrop-filter: blur(12px);
  border-radius: 18px;
  border: 1px solid rgba(212,175,55,0.15);
  padding: 16px;
  box-shadow: 0 0 20px rgba(0,0,0,0.5);
  display: flex;
  flex-direction: column;
}

.panel-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
  font-weight: 600;
  font-size: 16px;
  color: #d4af37;
}

.students-list, .sessions {
  overflow-y: auto;
  max-height: 60vh;
}

.student, .sess-item {
  background: rgba(0,0,0,0.35);
  margin-bottom: 10px;
  padding: 10px;
  border-radius: 12px;
  cursor: pointer;
  transition: 0.25s;
}
.student:hover, .sess-item:hover {
  background: rgba(212,175,55,0.08);
}
.student.active {
  border: 1px solid rgba(212,175,55,0.35);
  box-shadow: inset 0 0 0 2px rgba(212,175,55,0.08);
}

.input, select, textarea {
  width: 100%;
  padding: 10px;
  margin-top: 6px;
  border-radius: 12px;
  border: 1px solid rgba(212,175,55,0.25);
  background: rgba(0,0,0,0.35);
  color: #d4af37;
  font-size: 14px;
  transition: 0.25s;
}
.input:focus, select:focus, textarea:focus {
  outline: none;
  border-color: #d4af37;
  box-shadow: 0 0 10px rgba(212,175,55,0.4);
}

.full {
  width: 100%;
}

.footer {
  text-align: center;
  font-size: 13px;
  color: rgba(212,175,55,0.7);
  margin-top: 12px;
}

/* Modal */
.modal-back {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.7);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
}
.modal {
  background: rgba(15,15,15,0.52);
  backdrop-filter: blur(12px);
  border-radius: 18px;
  border: 1px solid rgba(212,175,55,0.15);
  padding: 24px;
  width: 520px;
  color: #d4af37;
}

/* Small animation */
@keyframes fadeIn {
  from {opacity: 0; transform: translateY(10px);}
  to {opacity: 1; transform: translateY(0);}
}
.panel, .btn, .student, .sess-item {
  animation: fadeIn 0.7s ease;
}

@media(max-width: 980px){
  .layout {grid-template-columns:1fr;}
  .modal {width: 92%;}
}
</style>
</head>
<body>

<div class="app">
<header class="top">
  <div class="brand">
    <div class="logo">NEXON</div>
    <div class="subtitle">Session Logger</div>
  </div>
  <div class="controls">
    <button id="logoutBtn" class="btn">Logout</button>
  </div>
</header>

<main class="layout">
<aside class="panel left">
  <div class="panel-header"><h3>Students</h3></div>
  <div id="studentsList" class="students-list"></div>
</aside>

<section class="panel middle">
  <div class="panel-header"><h3>Session Logger</h3></div>
  <div id="selectedStudentArea" class="selected-area"></div>
  <div id="studentSessions" class="sessions"></div>
</section>
</main>

<footer class="footer">Data is stored in your browser (localStorage).</footer>
</div>

<div id="modalRoot"></div>

<script>
(() => {
const API_URL = 'http://localhost:3000'; // ADDED: API Configuration

const $=id=>document.getElementById(id);
const genId=()=>`${Date.now()}_${Math.random().toString(36).slice(2,6)}`;
// Removed: const save=(k,v)=>localStorage.setItem(k,JSON.stringify(v));
// Removed: const load=k=>JSON.parse(localStorage.getItem(k)||'null');

let students = []; // MODIFIED: Initialize empty, data will be fetched from server
let sessions = []; // MODIFIED: Initialize empty, data will be fetched from server
let selectedStudentId = null; // ADDED: New state variable for tracking selected student

const studentsList=$('studentsList');
const studentSessions=$('studentSessions');
const selectedStudentArea=$('selectedStudentArea');

const escapeHTML=s=>String(s||'').replace(/[&<>"]/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]));
// Removed: const saveAll=()=>{save(KEY_STUDENTS,students);save(KEY_SESSIONS,sessions);};

/* ========================
   API FUNCTIONS (ADDED)
=========================== */
async function refreshData() {
  try {
    const res = await fetch(`${API_URL}/api/data`);
    if(!res.ok) throw new Error("Netwerk fout");
    const data = await res.json();
    students = data.students || [];
    sessions = data.sessions || [];
    
    renderStudents();
    if(selectedStudentId) selectStudent(selectedStudentId); // Keep selected student active/sessions loaded
  } catch(err) {
    console.error(err);
    alert("Could not fetch data from the server.");
  }
}

async function saveSessionToCloud(sessionObj) {
  try {
    const res = await fetch(`${API_URL}/api/session`, {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify(sessionObj)
    });
    const json = await res.json();
    if(json.success) {
      refreshData();
    } else {
      alert("Error saving session: " + json.error);
    }
  } catch(err) {
    alert("Could not reach server.");
  }
}

async function deleteSessionCloud(id) {
  try {
    await fetch(`${API_URL}/api/session/${id}`, { method: 'DELETE' });
    refreshData();
  } catch(err) {
    alert("Error deleting session.");
  }
}
/* ========================
   END API FUNCTIONS
=========================== */

// RENDER STUDENTS
function renderStudents(){
  studentsList.innerHTML='';
  if(!students.length){studentsList.innerHTML='<div>No students loaded</div>'; return;}
  students.forEach(s=>{
    const div=document.createElement('div');
    div.className='student';
    div.dataset.id=s.id;
    div.innerHTML=`<div style="font-weight:700;color:#d4af37">${escapeHTML(s.name)}</div>`;
    div.onclick=()=>selectStudent(s.id);
    studentsList.appendChild(div);
  });
}

// SELECT STUDENT
function selectStudent(id){
  selectedStudentId = id; // ADDED: Track selected student globally
  Array.from(document.querySelectorAll('.student')).forEach(el=>el.classList.toggle('active',el.dataset.id===id));
  const st=students.find(x=>x.id===id);
  selectedStudentArea.innerHTML=`<strong>${escapeHTML(st.name)}</strong> <button id="openLog" class="btn small">Log Session</button>`;
  $('openLog').onclick=()=>openLogModal({studentId:id});
  renderStudentSessions(id);
}

// RENDER STUDENT SESSIONS
function renderStudentSessions(studentId){
  studentSessions.innerHTML='';
  const list=sessions.filter(s=>s.studentId===studentId).sort((a,b)=>new Date(b.datetime)-new Date(a.datetime));
  if(!list.length){studentSessions.innerHTML='<div>No sessions yet</div>'; return;}
  list.forEach(s=>{
    const div=document.createElement('div'); div.className='sess-item';
    div.innerHTML=`<div style="font-weight:700">${escapeHTML(s.subject)} â€” ${escapeHTML(s.mode)}</div>
                     <div>${s.hours}h â€” ${new Date(s.datetime).toLocaleDateString()}</div>
                     <div>${s.notes||''}</div>
                     <div><button class="btn small" data-edit="${s.id}">Edit</button>
                     <button class="btn small" data-del="${s.id}">Delete</button></div>`;
    setTimeout(()=>{
      div.querySelector('[data-edit]').onclick=()=>openLogModal(s);
      div.querySelector('[data-del]').onclick=()=>{
        if(confirm('Delete session?')){
          // MODIFIED: Use cloud API instead of local storage
          deleteSessionCloud(s.id);
        }
      }
    },0);
    studentSessions.appendChild(div);
  });
}

// MODAL
function openLogModal(data){
  const isEdit=!!data.id;
  const modalBack=document.createElement('div'); modalBack.className='modal-back';
  const modal=document.createElement('div'); modal.className='modal';
  modal.innerHTML=`<h3>${isEdit?'Edit':'New'} Session</h3>
    <label>Subject<select id="sessSubject" class="full"><option>Wiskunde</option><option>Wetenskap</option></select></label>
    <label>Mode<select id="sessMode" class="full"><option>Individual</option><option>Group</option></select></label>
    <div class="form-row">
      <div class="form-col"><label>Hours<input type="number" min="0.5" step="0.5" id="sessHours" class="full"></label></div>
      <div class="form-col"><label>Date<input type="date" id="sessDate" class="full"></label></div>
    </div>
    <label>Notes<textarea id="sessNotes" class="full" rows="2"></textarea></label>
    <div style="margin-top:10px;text-align:right">
      <button id="saveSess" class="btn">Save</button>
      <button id="cancelSess" class="btn">Cancel</button>
    </div>`;
  modalBack.appendChild(modal); document.body.appendChild(modalBack);

  if(isEdit){ $('sessSubject').value=data.subject; $('sessMode').value=data.mode; $('sessHours').value=data.hours; $('sessDate').value=data.datetime; $('sessNotes').value=data.notes||'';}
  else { $('sessDate').value=new Date().toISOString().slice(0,10); $('sessHours').value=1; }

  $('cancelSess').onclick=()=>modalBack.remove();
  $('saveSess').onclick=()=>{
    const obj={
      id:isEdit?data.id:genId(),
      studentId:data.studentId,
      subject:$('sessSubject').value,
      mode:$('sessMode').value,
      hours:Number($('sessHours').value),
      datetime:$('sessDate').value,
      notes:$('sessNotes').value
    };
    // MODIFIED: Use cloud API instead of local storage manipulation
    saveSessionToCloud(obj);
    modalBack.remove();
  };
}

// INIT
refreshData(); // MODIFIED: Call refreshData to load data from the server

// LOGOUT BUTTON
document.getElementById('logoutBtn').onclick = () => {
  if(confirm('Are you sure you want to logout?')){
    window.location.href = 'login.html';
  }
};
})();
</script>

</body>
</html>


